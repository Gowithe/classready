{% extends "base.html" %}

{% block title %}Dashboard - Teacher Platform{% endblock %}

{% block extra_css %}
<style>
  :root {
    --primary: #667eea;
    --primary-dark: #5a67d8;
    --secondary: #764ba2;
    --bg-soft: #f8fafc;
    --text-main: #1e293b;
    --text-muted: #64748b;
    --danger: #ef4444;
  }

  body { background-color: var(--bg-soft); }

  /* Welcome Banner */
  .welcome-banner {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    border-radius: 20px;
    padding: 2.5rem;
    color: white;
    margin-bottom: 2.5rem;
    box-shadow: 0 10px 25px rgba(102, 126, 234, 0.25);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1.5rem;
  }
  .welcome-text h1 { margin: 0 0 0.5rem; font-size: 2rem; }
  .welcome-text p { margin: 0; opacity: 0.9; font-size: 1.1rem; }

  /* Main Action Buttons */
  .action-bar {
    display: flex; gap: 10px; flex-wrap: wrap;
  }
  .btn-action {
    background: rgba(255, 255, 255, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: white;
    padding: 0.8rem 1.2rem;
    border-radius: 12px;
    font-weight: 700;
    text-decoration: none;
    transition: all 0.2s;
    display: inline-flex; align-items: center; gap: 8px;
    backdrop-filter: blur(5px);
  }
  .btn-action:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
  }
  .btn-action.primary {
    background: white; color: var(--primary);
  }
  .btn-action.primary:hover {
    background: #f0f4ff; color: var(--primary-dark);
  }

  /* Section Styles */
  .section-header {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 1.5rem; padding-left: 0.5rem; border-left: 5px solid var(--primary);
  }
  .section-header h3 { margin: 0; font-size: 1.4rem; color: var(--text-main); padding-left: 10px; }

  /* Topic Grid */
  .topic-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 3rem;
  }

  /* Card Design */
  .topic-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.02);
    border: 1px solid rgba(0,0,0,0.05);
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex; flex-direction: column;
    overflow: hidden;
    position: relative;
  }
  .topic-card::before {
    content: ""; position: absolute; top: 0; left: 0; right: 0; height: 6px;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
  }
  .topic-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 20px rgba(0,0,0,0.08);
  }

  .card-body { padding: 1.5rem; flex: 1; }
  .card-title {
    font-size: 1.2rem; font-weight: 800; color: var(--text-main);
    margin: 0 0 0.5rem; display: block; text-decoration: none;
  }
  .card-title:hover { color: var(--primary); }
  .card-desc {
    font-size: 0.9rem; color: var(--text-muted); margin: 0;
    display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
  }

  /* Quick Links (Pills) */
  .card-tools {
    padding: 0 1.5rem 1rem;
    display: flex; flex-wrap: wrap; gap: 8px;
  }
  .tool-pill {
    font-size: 0.8rem; font-weight: 700; padding: 6px 12px;
    border-radius: 20px; text-decoration: none; transition: all 0.15s;
    border: 1px solid transparent;
  }
  .pill-slides { background: #eef2ff; color: var(--primary); }
  .pill-slides:hover { background: #e0e7ff; border-color: var(--primary); }
  
  .pill-game { background: #f0fdf4; color: #166534; }
  .pill-game:hover { background: #dcfce7; border-color: #22c55e; }
  
  .pill-practice { background: #fffbeb; color: #92400e; }
  .pill-practice:hover { background: #fef3c7; border-color: #f59e0b; }

  /* Card Footer */
  .card-footer {
    padding: 1rem 1.5rem;
    background: #f9fafb;
    border-top: 1px solid #f1f5f9;
    display: flex; justify-content: space-between; align-items: center;
  }
  .btn-icon {
    background: none; border: none; cursor: pointer;
    font-size: 0.9rem; color: var(--text-muted);
    padding: 6px; border-radius: 6px; transition: all 0.2s;
    display: flex; align-items: center; gap: 4px; text-decoration: none;
  }
  .btn-icon:hover { background: #e2e8f0; color: var(--text-main); }
  .btn-icon.danger:hover { background: #fee2e2; color: var(--danger); }

  /* Recent List */
  .recent-list {
    list-style: none; padding: 0; margin: 0;
    background: white; border-radius: 12px; overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  }
  .recent-item {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #f1f5f9;
    display: flex; justify-content: space-between; align-items: center;
    transition: background 0.15s;
  }
  .recent-item:last-child { border-bottom: none; }
  .recent-item:hover { background: #f8fafc; }
  .recent-name { font-weight: 600; color: var(--text-main); }
  .recent-link { color: var(--primary); text-decoration: none; font-weight: 700; font-size: 0.9rem; }

  /* Empty State */
  .empty-state {
    text-align: center; padding: 3rem; background: white; border-radius: 16px;
    border: 2px dashed #cbd5e1; color: var(--text-muted);
  }

  @media (max-width: 640px) {
    .welcome-banner { padding: 1.5rem; flex-direction: column; align-items: flex-start; }
    .action-bar { width: 100%; }
    .btn-action { flex: 1; justify-content: center; }
  }
</style>
{% endblock %}

{% block content %}

<div class="welcome-banner">
  <div class="welcome-text">
    <h1>üëã Welcome, Teacher!</h1>
    <p>Manage your lessons, games, and classrooms efficiently.</p>
  </div>
  <div class="action-bar">
    <a href="{{ url_for('classrooms') }}" class="btn-action primary">
      üè´ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
    </a>
    <a href="{{ url_for('my_create_topic') }}" class="btn-action">
      ‚ûï Create Topic
    </a>
    <a href="{{ url_for('ai_slides') }}" class="btn-action">
      ‚ú® AI Slides
    </a>
    {% if session.role == 'admin' %}
      <a href="{{ url_for('admin_dashboard') }}" class="btn-action">‚öôÔ∏è Admin</a>
    {% endif %}
  </div>
</div>

{% if recent %}
<div style="margin-bottom: 3rem;">
  <div class="section-header">
    <h3>üïí Recently Opened</h3>
  </div>
  <ul class="recent-list">
    {% for item in recent %}
      <li class="recent-item">
        <div class="recent-name">üìÑ {{ item.name }}</div>
        <a href="{{ url_for('topic_detail', topic_id=item.topic_id) }}" class="recent-link">View Lesson ‚Üí</a>
      </li>
    {% endfor %}
  </ul>
</div>
{% endif %}

<div class="section-header">
  <h3>üìö My Topics</h3>
</div>

{% if my_topics %}
  <div class="topic-grid">
    {% for topic in my_topics %}
    <div class="topic-card">
      <div class="card-body">
        <a href="{{ url_for('topic_detail', topic_id=topic.id) }}" class="card-title">
          {{ topic.name }}
        </a>
        <p class="card-desc">{{ topic.description or 'No description provided.' }}</p>
      </div>
      
      <div class="card-tools">
        <a href="{{ url_for('view_slides', topic_id=topic.id) }}" class="tool-pill pill-slides">üìΩ Slides</a>
        <a href="{{ url_for('game', topic_id=topic.id) }}" class="tool-pill pill-game">üéÆ Game</a>
        <a href="{{ url_for('practice', topic_id=topic.id) }}" class="tool-pill pill-practice">üìù Practice</a>
      </div>

      <div class="card-footer">
        <a href="{{ url_for('topic_detail', topic_id=topic.id) }}" class="btn-icon">
          üìÇ Open
        </a>
        <div style="display:flex; gap:4px;">
          <a href="{{ url_for('my_edit_topic', topic_id=topic.id) }}" class="btn-icon" title="Edit">
            ‚úèÔ∏è
          </a>
          <form method="POST" action="{{ url_for('my_delete_topic', topic_id=topic.id) }}" style="display:inline;">
            <button class="btn-icon danger" onclick="return confirm('Are you sure you want to delete this topic?');" title="Delete">
              üóë
            </button>
          </form>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
{% else %}
  <div class="empty-state">
    <div style="font-size: 3rem; margin-bottom: 1rem;">üì≠</div>
    <h3>You have no topics yet.</h3>
    <p>Get started by creating your first lesson topic.</p>
    <a href="{{ url_for('my_create_topic') }}" class="btn-action primary" style="margin-top:1rem; display:inline-flex; border:1px solid #ccc;">
      ‚ûï Create My Topic
    </a>
  </div>
{% endif %}

{% if session.role == 'admin' %}
<div class="section-header" style="margin-top: 4rem; border-color: #334155;">
  <h3 style="color: #334155;">üõ°Ô∏è All Topics (Admin View)</h3>
</div>
{% if topics %}
  <div class="topic-grid">
    {% for topic in topics %}
    <div class="topic-card" style="opacity: 0.9;">
      <div class="card-body">
        <div style="font-size:0.8rem; color:#64748b; margin-bottom:4px;">ID: {{ topic.id }}</div>
        <a href="{{ url_for('topic_detail', topic_id=topic.id) }}" class="card-title">
          {{ topic.name }}
        </a>
        <p class="card-desc">{{ topic.description or '-' }}</p>
      </div>
      <div class="card-footer">
        <a href="{{ url_for('topic_detail', topic_id=topic.id) }}" class="btn-icon">Open</a>
        <span style="font-size:0.8rem; color:#94a3b8;">Admin Mode</span>
      </div>
    </div>
    {% endfor %}
  </div>
{% else %}
  <p style="color:#64748b; padding-left:1rem;">No topics in the system.</p>
{% endif %}
{% endif %}

{% endblock %}
