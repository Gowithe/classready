{% extends "base.html" %}

{% block title %}Dashboard - Teacher Platform{% endblock %}

{% block extra_css %}
<style>
  :root {
    --primary: #667eea;
    --primary-dark: #5a67d8;
    --secondary: #764ba2;
    --bg-soft: #f8fafc;
    --text-main: #1e293b;
    --text-muted: #64748b;
    --danger: #ef4444;
    --success: #22c55e;
    --warning: #f59e0b;
  }

  body { background-color: var(--bg-soft); }

  /* Welcome Banner */
  .welcome-banner {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    border-radius: 20px;
    padding: 2rem;
    color: white;
    margin-bottom: 2rem;
    box-shadow: 0 10px 25px rgba(102, 126, 234, 0.25);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
  }
  .welcome-text h1 { margin: 0 0 0.3rem; font-size: 1.8rem; }
  .welcome-text p { margin: 0; opacity: 0.9; font-size: 1rem; }

  .action-bar { display: flex; gap: 10px; flex-wrap: wrap; }
  .btn-action {
    background: rgba(255, 255, 255, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: white;
    padding: 0.7rem 1rem;
    border-radius: 12px;
    font-weight: 700;
    text-decoration: none;
    transition: all 0.2s;
    display: inline-flex; align-items: center; gap: 8px;
    font-size: 0.9rem;
  }
  .btn-action:hover { background: rgba(255, 255, 255, 0.3); transform: translateY(-2px); }
  .btn-action.primary { background: white; color: var(--primary); }

  /* Stats Cards */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }
  .stat-card {
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    border: 1px solid rgba(0,0,0,0.05);
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  .stat-icon {
    width: 56px;
    height: 56px;
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
  }
  .stat-icon.purple { background: linear-gradient(135deg, #667eea, #764ba2); }
  .stat-icon.green { background: linear-gradient(135deg, #22c55e, #16a34a); }
  .stat-icon.orange { background: linear-gradient(135deg, #f59e0b, #d97706); }
  .stat-icon.blue { background: linear-gradient(135deg, #3b82f6, #2563eb); }
  .stat-info h3 { margin: 0; font-size: 1.8rem; color: var(--text-main); }
  .stat-info p { margin: 0; font-size: 0.85rem; color: var(--text-muted); }

  /* Dashboard Grid */
  .dashboard-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 1.5rem;
    margin-bottom: 2rem;
  }
  @media (max-width: 1024px) {
    .dashboard-grid { grid-template-columns: 1fr; }
  }

  /* Card */
  .card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    border: 1px solid rgba(0,0,0,0.05);
    overflow: hidden;
  }
  .card-header {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #f1f5f9;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .card-header h3 { margin: 0; font-size: 1.1rem; color: var(--text-main); }
  .card-body { padding: 1.5rem; }

  /* Chart Container */
  .chart-container {
    position: relative;
    height: 280px;
  }

  /* Alert List */
  .alert-list { list-style: none; padding: 0; margin: 0; }
  .alert-item {
    padding: 1rem;
    border-bottom: 1px solid #f1f5f9;
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
  }
  .alert-item:last-child { border-bottom: none; }
  .alert-icon {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    flex-shrink: 0;
  }
  .alert-icon.danger { background: #fee2e2; }
  .alert-icon.warning { background: #fef3c7; }
  .alert-icon.success { background: #dcfce7; }
  .alert-content h4 { margin: 0 0 2px; font-size: 0.9rem; color: var(--text-main); }
  .alert-content p { margin: 0; font-size: 0.8rem; color: var(--text-muted); }

  /* Student List */
  .student-list { list-style: none; padding: 0; margin: 0; }
  .student-item {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #f1f5f9;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .student-item:last-child { border-bottom: none; }
  .student-info { display: flex; align-items: center; gap: 0.75rem; }
  .student-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 0.85rem;
  }
  .avatar-gold { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: white; }
  .avatar-silver { background: linear-gradient(135deg, #9ca3af, #6b7280); color: white; }
  .avatar-bronze { background: linear-gradient(135deg, #d97706, #b45309); color: white; }
  .avatar-default { background: #e2e8f0; color: #64748b; }
  .avatar-danger { background: #fee2e2; color: #dc2626; }
  .student-name { font-weight: 600; font-size: 0.9rem; color: var(--text-main); }
  .student-class { font-size: 0.75rem; color: var(--text-muted); }
  .student-score {
    font-weight: 700;
    font-size: 0.9rem;
    padding: 4px 10px;
    border-radius: 20px;
  }
  .score-high { background: #dcfce7; color: #166534; }
  .score-mid { background: #fef3c7; color: #92400e; }
  .score-low { background: #fee2e2; color: #991b1b; }

  /* Classroom Progress */
  .classroom-item {
    padding: 1rem;
    border-bottom: 1px solid #f1f5f9;
  }
  .classroom-item:last-child { border-bottom: none; }
  .classroom-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }
  .classroom-name { font-weight: 700; font-size: 0.95rem; color: var(--text-main); }
  .classroom-stat { font-size: 0.8rem; color: var(--text-muted); }
  .progress-bar {
    height: 8px;
    background: #e2e8f0;
    border-radius: 4px;
    overflow: hidden;
  }
  .progress-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.3s ease;
  }
  .progress-fill.green { background: linear-gradient(90deg, #22c55e, #16a34a); }
  .progress-fill.yellow { background: linear-gradient(90deg, #f59e0b, #d97706); }
  .progress-fill.red { background: linear-gradient(90deg, #ef4444, #dc2626); }

  /* Section Header */
  .section-header {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 1.5rem; padding-left: 0.5rem; border-left: 5px solid var(--primary);
  }
  .section-header h3 { margin: 0; font-size: 1.3rem; color: var(--text-main); padding-left: 10px; }

  /* Topic Grid */
  .topic-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.25rem;
    margin-bottom: 2rem;
  }

  .topic-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.02);
    border: 1px solid rgba(0,0,0,0.05);
    transition: all 0.2s;
    overflow: hidden;
    position: relative;
  }
  .topic-card::before {
    content: ""; position: absolute; top: 0; left: 0; right: 0; height: 5px;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
  }
  .topic-card:hover { transform: translateY(-4px); box-shadow: 0 10px 20px rgba(0,0,0,0.08); }

  .card-body-topic { padding: 1.25rem; }
  .card-title {
    font-size: 1.1rem; font-weight: 800; color: var(--text-main);
    margin: 0 0 0.4rem; display: block; text-decoration: none;
  }
  .card-title:hover { color: var(--primary); }
  .card-desc {
    font-size: 0.85rem; color: var(--text-muted); margin: 0;
    display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
  }

  .card-tools {
    padding: 0 1.25rem 1rem;
    display: flex; flex-wrap: wrap; gap: 6px;
  }
  .tool-pill {
    font-size: 0.75rem; font-weight: 700; padding: 5px 10px;
    border-radius: 20px; text-decoration: none; transition: all 0.15s;
  }
  .pill-slides { background: #eef2ff; color: var(--primary); }
  .pill-game { background: #f0fdf4; color: #166534; }
  .pill-practice { background: #fffbeb; color: #92400e; }

  .card-footer-topic {
    padding: 0.75rem 1.25rem;
    background: #f9fafb;
    border-top: 1px solid #f1f5f9;
    display: flex; justify-content: space-between; align-items: center;
  }
  .btn-icon {
    background: none; border: none; cursor: pointer;
    font-size: 0.85rem; color: var(--text-muted);
    padding: 5px; border-radius: 6px; transition: all 0.2s;
    display: flex; align-items: center; gap: 4px; text-decoration: none;
  }
  .btn-icon:hover { background: #e2e8f0; color: var(--text-main); }
  .btn-icon.danger:hover { background: #fee2e2; color: var(--danger); }

  /* Empty State */
  .empty-state {
    text-align: center; padding: 2rem; color: var(--text-muted);
  }
  .empty-state-icon { font-size: 2.5rem; margin-bottom: 0.5rem; }

  /* Badge */
  .badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 0.7rem;
    font-weight: 700;
  }
  .badge-new { background: #dbeafe; color: #2563eb; }

  /* View All Link */
  .view-all {
    font-size: 0.85rem;
    color: var(--primary);
    text-decoration: none;
    font-weight: 600;
  }
  .view-all:hover { text-decoration: underline; }

  @media (max-width: 640px) {
    .welcome-banner { padding: 1.25rem; flex-direction: column; align-items: flex-start; }
    .action-bar { width: 100%; }
    .btn-action { flex: 1; justify-content: center; font-size: 0.8rem; padding: 0.6rem 0.8rem; }
    .stats-grid { grid-template-columns: repeat(2, 1fr); }
  }
</style>
{% endblock %}

{% block content %}

<!-- Welcome Banner -->
<div class="welcome-banner">
  <div class="welcome-text">
    <h1>üëã ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, {{ session.username or 'Teacher' }}!</h1>
    <p>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà Teacher Platform</p>
  </div>
  <div class="action-bar">
    <a href="{{ url_for('classrooms') }}" class="btn-action primary">üè´ ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</a>
    <a href="{{ url_for('my_create_topic') }}" class="btn-action">‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á Topic</a>
    <a href="{{ url_for('ai_slides') }}" class="btn-action">‚ú® AI Slides</a>
    {% if session.role == 'admin' %}
    <a href="{{ url_for('admin_dashboard') }}" class="btn-action">‚öôÔ∏è Admin</a>
    {% endif %}
  </div>
</div>

<!-- Stats Overview -->
<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-icon purple">üìö</div>
    <div class="stat-info">
      <h3>{{ stats.total_topics }}</h3>
      <p>Topics ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
    </div>
  </div>
  <div class="stat-card">
    <div class="stat-icon green">üè´</div>
    <div class="stat-info">
      <h3>{{ stats.total_classrooms }}</h3>
      <p>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
    </div>
  </div>
  <div class="stat-card">
    <div class="stat-icon blue">üë®‚Äçüéì</div>
    <div class="stat-info">
      <h3>{{ stats.total_students }}</h3>
      <p>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
    </div>
  </div>
  <div class="stat-card">
    <div class="stat-icon orange">üìù</div>
    <div class="stat-info">
      <h3>{{ stats.total_submissions }}</h3>
      <p>‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
    </div>
  </div>
</div>

<!-- Dashboard Grid -->
<div class="dashboard-grid">
  <!-- Left Column -->
  <div>
    <!-- Classroom Progress Chart -->
    <div class="card" style="margin-bottom: 1.5rem;">
      <div class="card-header">
        <h3>üìä ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
        <a href="{{ url_for('classrooms') }}" class="view-all">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Üí</a>
      </div>
      <div class="card-body">
        {% if classroom_progress %}
        <div class="chart-container">
          <canvas id="progressChart"></canvas>
        </div>
        {% else %}
        <div class="empty-state">
          <div class="empty-state-icon">üìä</div>
          <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Classroom Submission Status -->
    <div class="card">
      <div class="card-header">
        <h3>üè´ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á</h3>
      </div>
      <div class="card-body" style="padding: 0;">
        {% if classroom_progress %}
        {% for cp in classroom_progress %}
        <div class="classroom-item">
          <div class="classroom-header">
            <span class="classroom-name">{{ cp.name }}</span>
            <span class="classroom-stat">‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß {{ cp.submitted }}/{{ cp.total }} ‡∏Ñ‡∏ô ({{ cp.percentage }}%)</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill {% if cp.percentage >= 80 %}green{% elif cp.percentage >= 50 %}yellow{% else %}red{% endif %}" 
                 style="width: {{ cp.percentage }}%"></div>
          </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="empty-state">
          <div class="empty-state-icon">üè´</div>
          <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
          <a href="{{ url_for('classrooms') }}" class="btn-action primary" style="margin-top: 0.5rem; display: inline-flex;">‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</a>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Right Column -->
  <div>
    <!-- Alerts -->
    <div class="card" style="margin-bottom: 1.5rem;">
      <div class="card-header">
        <h3>üîî ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
        <span class="badge badge-new">{{ alerts|length }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
      </div>
      <div class="card-body" style="padding: 0; max-height: 300px; overflow-y: auto;">
        {% if alerts %}
        <ul class="alert-list">
          {% for alert in alerts[:10] %}
          <li class="alert-item">
            <div class="alert-icon {{ alert.type }}">
              {% if alert.type == 'danger' %}‚ö†Ô∏è{% elif alert.type == 'warning' %}‚è∞{% else %}‚úÖ{% endif %}
            </div>
            <div class="alert-content">
              <h4>{{ alert.title }}</h4>
              <p>{{ alert.message }}</p>
            </div>
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <div class="empty-state">
          <div class="empty-state-icon">üéâ</div>
          <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Top Performers -->
    <div class="card" style="margin-bottom: 1.5rem;">
      <div class="card-header">
        <h3>üèÜ ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</h3>
      </div>
      <div class="card-body" style="padding: 0;">
        {% if top_students %}
        <ul class="student-list">
          {% for student in top_students[:5] %}
          <li class="student-item">
            <div class="student-info">
              <div class="student-avatar {% if loop.index == 1 %}avatar-gold{% elif loop.index == 2 %}avatar-silver{% elif loop.index == 3 %}avatar-bronze{% else %}avatar-default{% endif %}">
                {{ loop.index }}
              </div>
              <div>
                <div class="student-name">{{ student.name }}</div>
                <div class="student-class">{{ student.classroom }}</div>
              </div>
            </div>
            <span class="student-score score-high">{{ student.avg_score }}%</span>
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <div class="empty-state">
          <div class="empty-state-icon">üèÜ</div>
          <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Need Help -->
    <div class="card">
      <div class="card-header">
        <h3>üÜò ‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h3>
      </div>
      <div class="card-body" style="padding: 0;">
        {% if struggling_students %}
        <ul class="student-list">
          {% for student in struggling_students[:5] %}
          <li class="student-item">
            <div class="student-info">
              <div class="student-avatar avatar-danger">!</div>
              <div>
                <div class="student-name">{{ student.name }}</div>
                <div class="student-class">{{ student.classroom }}</div>
              </div>
            </div>
            <span class="student-score score-low">{{ student.avg_score }}%</span>
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <div class="empty-state">
          <div class="empty-state-icon">‚ú®</div>
          <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- My Topics Section -->
<div class="section-header">
  <h3>üìö Topics ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h3>
</div>

{% if my_topics %}
<div class="topic-grid">
  {% for topic in my_topics[:6] %}
  <div class="topic-card">
    <div class="card-body-topic">
      <a href="{{ url_for('topic_detail', topic_id=topic.id) }}" class="card-title">
        {{ topic.name }}
      </a>
      <p class="card-desc">{{ topic.description or '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢' }}</p>
    </div>
    
    <div class="card-tools">
      <a href="{{ url_for('view_slides', topic_id=topic.id) }}" class="tool-pill pill-slides">üìΩ Slides</a>
      <a href="{{ url_for('game', topic_id=topic.id) }}" class="tool-pill pill-game">üéÆ Game</a>
      <a href="{{ url_for('practice', topic_id=topic.id) }}" class="tool-pill pill-practice">üìù Practice</a>
    </div>

    <div class="card-footer-topic">
      <a href="{{ url_for('topic_detail', topic_id=topic.id) }}" class="btn-icon">üìÇ ‡πÄ‡∏õ‡∏¥‡∏î</a>
      <div style="display:flex; gap:4px;">
        <a href="{{ url_for('my_edit_topic', topic_id=topic.id) }}" class="btn-icon" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">‚úèÔ∏è</a>
        <form method="POST" action="{{ url_for('my_delete_topic', topic_id=topic.id) }}" style="display:inline;">
          <button class="btn-icon danger" onclick="return confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö topic ‡∏ô‡∏µ‡πâ?');" title="‡∏•‡∏ö">üóë</button>
        </form>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

{% if my_topics|length > 6 %}
<div style="text-align: center; margin-bottom: 2rem;">
  <a href="{{ url_for('my_topics') }}" class="btn-action primary" style="border: 1px solid #e2e8f0;">‡∏î‡∏π Topics ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ({{ my_topics|length }}) ‚Üí</a>
</div>
{% endif %}

{% else %}
<div class="empty-state" style="background: white; border-radius: 16px; border: 2px dashed #cbd5e1; margin-bottom: 2rem;">
  <div class="empty-state-icon">üì≠</div>
  <h3 style="margin: 0.5rem 0;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Topics</h3>
  <p>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Topic ‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
  <a href="{{ url_for('my_create_topic') }}" class="btn-action primary" style="margin-top:1rem; display:inline-flex; border:1px solid #ccc;">
    ‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á Topic
  </a>
</div>
{% endif %}

{% if recent %}
<!-- Recently Opened -->
<div class="section-header">
  <h3>üïí ‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
</div>
<div class="card" style="margin-bottom: 2rem;">
  <div class="card-body" style="padding: 0;">
    <ul class="student-list">
      {% for item in recent[:5] %}
      <li class="student-item">
        <div class="student-info">
          <div class="student-avatar avatar-default">üìÑ</div>
          <div>
            <div class="student-name">{{ item.name }}</div>
          </div>
        </div>
        <a href="{{ url_for('topic_detail', topic_id=item.topic_id) }}" class="view-all">‡πÄ‡∏õ‡∏¥‡∏î ‚Üí</a>
      </li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endif %}

{% if session.role == 'admin' %}
<div class="section-header" style="border-color: #334155;">
  <h3 style="color: #334155;">üõ°Ô∏è All Topics (Admin)</h3>
</div>
{% if topics %}
<div class="topic-grid">
  {% for topic in topics[:6] %}
  <div class="topic-card" style="opacity: 0.9;">
    <div class="card-body-topic">
      <div style="font-size:0.75rem; color:#64748b; margin-bottom:4px;">ID: {{ topic.id }}</div>
      <a href="{{ url_for('topic_detail', topic_id=topic.id) }}" class="card-title">{{ topic.name }}</a>
      <p class="card-desc">{{ topic.description or '-' }}</p>
    </div>
    <div class="card-footer-topic">
      <a href="{{ url_for('topic_detail', topic_id=topic.id) }}" class="btn-icon">‡πÄ‡∏õ‡∏¥‡∏î</a>
      <span style="font-size:0.75rem; color:#94a3b8;">Admin</span>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<p style="color:#64748b; padding-left:1rem;">‡πÑ‡∏°‡πà‡∏°‡∏µ topics ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
{% endif %}
{% endif %}

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
{% if classroom_progress %}
const ctx = document.getElementById('progressChart');
if (ctx) {
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: [{% for cp in classroom_progress %}'{{ cp.name }}'{% if not loop.last %}, {% endif %}{% endfor %}],
      datasets: [{
        label: '‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß (%)',
        data: [{% for cp in classroom_progress %}{{ cp.percentage }}{% if not loop.last %}, {% endif %}{% endfor %}],
        backgroundColor: [
          {% for cp in classroom_progress %}
          {% if cp.percentage >= 80 %}'rgba(34, 197, 94, 0.8)'{% elif cp.percentage >= 50 %}'rgba(245, 158, 11, 0.8)'{% else %}'rgba(239, 68, 68, 0.8)'{% endif %}{% if not loop.last %}, {% endif %}
          {% endfor %}
        ],
        borderRadius: 8,
        borderSkipped: false,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false }
      },
      scales: {
        y: {
          beginAtZero: true,
          max: 100,
          ticks: {
            callback: function(value) { return value + '%'; }
          }
        }
      }
    }
  });
}
{% endif %}
</script>

{% endblock %}
