{% extends "base.html" %}
{% block title %}{{ classroom.name }} | Classroom{% endblock %}

{% block extra_css %}
<style>
  .wrap{max-width:1400px;margin:1.25rem auto;padding:0 1rem;}
  
  .page-header{
    background:linear-gradient(135deg,#667eea,#764ba2);
    color:#fff;
    padding:24px 28px;
    border-radius:20px;
    margin-bottom:24px;
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    flex-wrap:wrap;
    gap:16px;
  }
  .header-info h1{margin:0 0 6px;font-size:1.6rem;font-weight:900;}
  .header-meta{display:flex;gap:16px;flex-wrap:wrap;opacity:.9;font-size:.95rem;}
  .header-meta span{display:flex;align-items:center;gap:6px;}
  .header-actions{display:flex;gap:10px;flex-wrap:wrap;}
  
  .btn{display:inline-flex;align-items:center;gap:.5rem;border:none;border-radius:12px;padding:.7rem 1.1rem;font-weight:700;text-decoration:none;cursor:pointer;transition:all .2s;font-size:.9rem;}
  .btn-white{background:rgba(255,255,255,.95);color:#667eea;}
  .btn-ghost{background:rgba(255,255,255,.15);color:#fff;border:1px solid rgba(255,255,255,.3);}
  .btn-primary{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;}
  .btn-secondary{background:#f1f5f9;color:#475569;border:1px solid #e2e8f0;}
  .btn-success{background:#22c55e;color:#fff;}
  
  .tabs{display:flex;gap:8px;margin-bottom:24px;border-bottom:2px solid #e2e8f0;}
  .tab{padding:12px 20px;font-weight:700;color:#64748b;cursor:pointer;border-bottom:3px solid transparent;margin-bottom:-2px;transition:all .2s;}
  .tab:hover{color:#667eea;}
  .tab.active{color:#667eea;border-bottom-color:#667eea;}
  .tab-content{display:none;}
  .tab-content.active{display:block;}
  
  .card{background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:16px;padding:20px;margin-bottom:20px;box-shadow:0 4px 12px rgba(0,0,0,.04);}
  .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid #f1f5f9;}
  .card-title{font-size:1.1rem;font-weight:800;color:#1e293b;}
  
  .table-container{overflow-x:auto;margin:0 -20px;padding:0 20px;}
  .student-table{width:100%;border-collapse:collapse;min-width:700px;}
  .student-table th,.student-table td{padding:10px 12px;text-align:left;border-bottom:1px solid #f1f5f9;white-space:nowrap;}
  .student-table th{background:#f8fafc;font-weight:700;font-size:.75rem;color:#64748b;text-transform:uppercase;position:sticky;top:0;}
  .student-table tr:hover td{background:#fafbfc;}
  
  .score-cell{text-align:center !important;min-width:70px;}
  .score-pill{display:inline-block;padding:3px 8px;border-radius:12px;font-weight:700;font-size:.75rem;}
  .score-high{background:#dcfce7;color:#166534;}
  .score-mid{background:#fef3c7;color:#92400e;}
  .score-low{background:#fee2e2;color:#991b1b;}
  .score-none{background:#f1f5f9;color:#94a3b8;}
  
  .total-cell{background:#f8fafc !important;}
  .total-score{font-weight:900;font-size:.9rem;color:#667eea;}
  .avg-score{font-size:.7rem;color:#64748b;display:block;}
  
  .student-actions{display:flex;gap:4px;}
  .student-actions button{padding:5px 8px;border:none;border-radius:6px;cursor:pointer;font-size:.75rem;}
  .btn-sm-edit{background:#dbeafe;color:#2563eb;}
  .btn-sm-del{background:#fee2e2;color:#dc2626;}
  
  .summary-row{background:#f1f5f9 !important;}
  .summary-row td{border-top:2px solid #e2e8f0;font-weight:700;}
  
  .assignment-card{background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:14px;padding:16px;margin-bottom:12px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;}
  .assignment-info h4{margin:0 0 4px;font-size:1rem;color:#1e293b;}
  .assignment-meta{display:flex;gap:16px;font-size:.85rem;color:#64748b;}
  
  .progress-bar{width:120px;height:8px;background:#e2e8f0;border-radius:4px;overflow:hidden;}
  .progress-fill{height:100%;background:linear-gradient(90deg,#667eea,#764ba2);}
  
  .quick-input{display:flex;gap:10px;margin-bottom:16px;}
  .quick-input input{flex:1;padding:.6rem .8rem;border:1px solid #e2e8f0;border-radius:8px;}
  
  .modal-overlay{display:none;position:fixed;inset:0;background:rgba(15,23,42,.6);z-index:1000;align-items:center;justify-content:center;padding:16px;}
  .modal-overlay.show{display:flex;}
  .modal-box{background:#fff;border-radius:20px;width:100%;max-width:600px;max-height:90vh;overflow:hidden;}
  .modal-header{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:20px 24px;display:flex;justify-content:space-between;align-items:center;}
  .modal-header h3{margin:0;}
  .modal-close{background:rgba(255,255,255,.2);border:none;color:#fff;width:32px;height:32px;border-radius:8px;cursor:pointer;font-size:1.1rem;}
  .modal-body{padding:24px;max-height:calc(90vh - 140px);overflow-y:auto;}
  .modal-footer{padding:16px 24px;background:#f8fafc;border-top:1px solid #e2e8f0;display:flex;justify-content:flex-end;gap:10px;}
  
  .form-group{margin-bottom:16px;}
  .form-group label{display:block;font-weight:700;margin-bottom:6px;color:#334155;}
  .form-group input,.form-group select,.form-group textarea{width:100%;padding:.75rem 1rem;border:1px solid #e2e8f0;border-radius:10px;font-size:1rem;}
  .form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
  
  .empty{text-align:center;padding:40px;color:#64748b;}
  .empty-icon{font-size:3rem;margin-bottom:12px;}
</style>
{% endblock %}

{% block content %}
<div class="wrap">
  <div class="page-header">
    <div class="header-info">
      <h1>üè´ {{ classroom.name }}</h1>
      <div class="header-meta">
        <span>üìö {{ classroom.grade_level or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏±‡πâ‡∏ô' }}</span>
        <span>üìÖ {{ classroom.academic_year or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏µ' }}</span>
        <span>üë®‚Äçüéì {{ students|length }} ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
        <span>üìã {{ assignments|length }} ‡∏á‡∏≤‡∏ô</span>
      </div>
    </div>
    <div class="header-actions">
      <a href="{{ url_for('classrooms') }}" class="btn btn-ghost">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</a>
      <button class="btn btn-white" onclick="openAssignModal()">üìù ‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
    </div>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="switchTab('students')">üë®‚Äçüéì ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ + ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
    <div class="tab" onclick="switchTab('assignments')">üìã ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢</div>
  </div>

  <div class="tab-content active" id="tab-students">
    <div class="card">
      <div class="card-header">
        <div class="card-title">üìä ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ({{ students|length }} ‡∏Ñ‡∏ô)</div>
        <div style="display:flex;gap:8px;">
          <button class="btn btn-secondary" onclick="openImportModal()">üì• Import</button>
          <button class="btn btn-primary" onclick="openAddStudentModal()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
        </div>
      </div>

      <form class="quick-input" action="{{ url_for('classroom_add_student', classroom_id=classroom.id) }}" method="POST">
        <input type="text" name="student_no" placeholder="‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà" style="width:70px;">
        <input type="text" name="student_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•" required>
        <input type="text" name="nickname" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô" style="width:100px;">
        <button type="submit" class="btn btn-success">‚ûï</button>
      </form>

      {% if students %}
      <div class="table-container">
        <table class="student-table">
          <thead>
            <tr>
              <th style="width:45px">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th>
              <th style="min-width:140px">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
              <th style="width:70px">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</th>
              {% for a in assignments %}
              <th class="score-cell" title="{{ a.title }}">{{ a.title[:8] }}{% if a.title|length > 8 %}..{% endif %}</th>
              {% endfor %}
              <th class="score-cell" style="background:#eef2ff;">‡∏£‡∏ß‡∏°</th>
              <th style="width:70px"></th>
            </tr>
          </thead>
          <tbody>
            {% for s in students %}
            {% set ss = scores_by_student.get(s.id, {}) %}
            {% set total = ss.get('total_score', 0) %}
            {% set possible = ss.get('total_possible', 0) %}
            {% set avg = (total / possible * 100) if possible > 0 else 0 %}
            <tr>
              <td><strong>{{ s.student_no or '-' }}</strong></td>
              <td>{{ s.student_name }}</td>
              <td style="color:#64748b;">{{ s.nickname or '-' }}</td>
              
              {% for a in assignments %}
              {% set sc = ss.get('assignments', {}).get(a.id) %}
              <td class="score-cell">
                {% if sc %}
                {% set p = sc.percentage|default(0)|int %}
                <span class="score-pill {% if p >= 80 %}score-high{% elif p >= 50 %}score-mid{% else %}score-low{% endif %}">{{ sc.score }}/{{ sc.total }}</span>
                {% else %}
                <span class="score-pill score-none">-</span>
                {% endif %}
              </td>
              {% endfor %}
              
              <td class="score-cell total-cell">
                {% if possible > 0 %}
                <span class="total-score">{{ total }}/{{ possible }}</span>
                <span class="avg-score">{{ '%.0f'|format(avg) }}%</span>
                {% else %}
                <span style="color:#94a3b8;">-</span>
                {% endif %}
              </td>
              <td class="student-actions">
                <button class="btn-sm-edit" 
                  data-id="{{ s.id }}"
                  data-no="{{ s.student_no or '' }}"
                  data-name="{{ s.student_name }}"
                  data-nickname="{{ s.nickname or '' }}"
                  onclick="editStudent(this)">‚úèÔ∏è</button>
                  
                <button class="btn-sm-del" 
                  data-id="{{ s.id }}"
                  data-name="{{ s.student_name }}"
                  onclick="deleteStudent(this)">üóëÔ∏è</button>
              </td>
            </tr>
            {% endfor %}
            
            {% if assignments %}
            <tr class="summary-row">
              <td colspan="3">üìä ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡πâ‡∏≠‡∏á</td>
              {% for a in assignments %}
              {% set ast = assignment_stats.get(a.id, {}) %}
              <td class="score-cell">
                {% if ast.get('count', 0) > 0 %}
                <span style="font-size:.8rem;">{{ '%.0f'|format(ast.get('avg', 0)) }}%</span>
                {% else %}-{% endif %}
              </td>
              {% endfor %}
              <td class="score-cell total-cell">
                {% if class_avg > 0 %}<strong style="color:#667eea;">{{ '%.0f'|format(class_avg) }}%</strong>{% else %}-{% endif %}
              </td>
              <td></td>
            </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="empty">
        <div class="empty-icon">üë®‚Äçüéì</div>
        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
      </div>
      {% endif %}
    </div>
  </div>

  <div class="tab-content" id="tab-assignments">
    <div class="card">
      <div class="card-header">
        <div class="card-title">üìù ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢</div>
        <button class="btn btn-primary" onclick="openAssignModal()">‚ûï ‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
      </div>
      {% if assignments %}
        {% for a in assignments %}
        <div class="assignment-card">
          <div class="assignment-info">
            <h4>{{ a.title }}</h4>
            <div class="assignment-meta">
              <span>üìö {{ a.topic_name }}</span>
              <span>üìã {% if a.exercise_type == 'fill_blanks' %}Fill Blanks{% elif a.exercise_type == 'unscramble' %}Unscramble{% else %}MCQ{% endif %}</span>
              {% if a.due_date %}<span>‚è∞ {{ a.due_date[:10] }}</span>{% endif %}
            </div>
          </div>
          <div style="display:flex;align-items:center;gap:12px;">
            {% set st = submission_stats.get(a.id, {}) %}
            <div>
              <div style="font-size:.85rem;color:#64748b;">‡∏™‡πà‡∏á {{ st.submitted|default(0) }}/{{ students|length }}</div>
              <div class="progress-bar"><div class="progress-fill" style="width:{{ ((st.submitted|default(0)) / students|length * 100) if students|length else 0 }}%"></div></div>
            </div>
            <a href="{{ url_for('assignment_detail', assignment_id=a.id) }}" class="btn btn-secondary" style="padding:.5rem .8rem;">üìä ‡∏î‡∏π‡∏ú‡∏•</a>
          </div>
        </div>
        {% endfor %}
      {% else %}
      <div class="empty">
        <div class="empty-icon">üìã</div>
        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô</p>
        <button class="btn btn-primary" onclick="openAssignModal()">‚ûï ‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏£‡∏Å</button>
      </div>
      {% endif %}
    </div>
  </div>
</div>

<div class="modal-overlay" id="studentModal">
  <div class="modal-box">
    <div class="modal-header">
      <h3 id="studentModalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
      <button class="modal-close" onclick="closeStudentModal()">‚úï</button>
    </div>
    <form id="studentForm" method="POST">
      <div class="modal-body">
        <input type="hidden" id="studentId" name="student_id">
        <div class="form-row">
          <div class="form-group"><label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</label><input type="text" id="studentNoModal" name="student_no"></div>
          <div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label><input type="text" id="studentNickname" name="nickname"></div>
        </div>
        <div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• *</label><input type="text" id="studentName" name="student_name" required></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeStudentModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button type="submit" class="btn btn-primary">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </form>
  </div>
</div>

<div class="modal-overlay" id="importModal">
  <div class="modal-box">
    <div class="modal-header">
      <h3>üì• Import ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</h3>
      <button class="modal-close" onclick="closeImportModal()">‚úï</button>
    </div>
    <form action="{{ url_for('classroom_import_students', classroom_id=classroom.id) }}" method="POST">
      <div class="modal-body">
        <div class="form-group">
          <label>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏•‡∏∞‡∏Ñ‡∏ô)</label>
          <textarea name="student_list" rows="10" placeholder="1	‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ
2	‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"></textarea>
        </div>
        <p style="font-size:.85rem;color:#64748b;">üí° ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà[Tab]‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeImportModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button type="submit" class="btn btn-success">üì• Import</button>
      </div>
    </form>
  </div>
</div>

<div class="modal-overlay" id="assignModal">
  <div class="modal-box">
    <div class="modal-header">
      <h3>üìù ‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
      <button class="modal-close" onclick="closeAssignModal()">‚úï</button>
    </div>
    <form action="{{ url_for('classroom_assign', classroom_id=classroom.id) }}" method="POST">
      <div class="modal-body">
        <div class="form-group">
          <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Topic *</label>
          <select name="topic_id" required>
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
            {% for t in topics %}<option value="{{ t.id }}">{{ t.name }}</option>{% endfor %}
          </select>
        </div>
        <div class="form-group">
          <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î *</label>
          <select name="exercise_type" required>
            <option value="mcq" selected>üìù MCQ - ‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏ô‡∏±‡∏¢</option>
            <option value="fill_blanks">‚úèÔ∏è Fill Blanks - ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á</option>
            <option value="unscramble">üîÄ Unscramble - ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ</option>
          </select>
        </div>
        <div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô</label><input type="text" name="title" placeholder="‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏ö‡∏ó‡∏ó‡∏µ‡πà 1"></div>
        <div class="form-group"><label>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</label><textarea name="description" rows="2"></textarea></div>
        <div class="form-group"><label>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á</label><input type="datetime-local" name="due_date"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeAssignModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button type="submit" class="btn btn-primary">üìù ‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô</button>
      </div>
    </form>
  </div>
</div>

<script>
function switchTab(t){document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));document.querySelectorAll('.tab-content').forEach(x=>x.classList.remove('active'));document.querySelector(`.tab[onclick="switchTab('${t}')"]`).classList.add('active');document.getElementById(`tab-${t}`).classList.add('active');}

// --- Student Management (Updated) ---
const studentModal=document.getElementById('studentModal');
const studentForm=document.getElementById('studentForm');

function openAddStudentModal(){
  document.getElementById('studentModalTitle').textContent='‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô';
  studentForm.action="{{ url_for('classroom_add_student', classroom_id=classroom.id) }}";
  studentForm.reset();
  document.getElementById('studentId').value = "";
  studentModal.classList.add('show');
}

// Function Edit ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà (‡πÉ‡∏ä‡πâ dataset)
function editStudent(btn){
  const id = btn.dataset.id;
  const no = btn.dataset.no;
  const name = btn.dataset.name;
  const nickname = btn.dataset.nickname;

  document.getElementById('studentModalTitle').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô';
  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL Action ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Route ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Edit
  studentForm.action = `/classroom/student/${id}/edit`;
  
  document.getElementById('studentId').value = id;
  document.getElementById('studentNoModal').value = no;
  document.getElementById('studentName').value = name;
  document.getElementById('studentNickname').value = nickname;
  
  studentModal.classList.add('show');
}

function deleteStudent(btn){
  const id = btn.dataset.id;
  const name = btn.dataset.name;
  if(!confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö "${name}" ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) return;
  
  const f=document.createElement('form');
  f.method='POST';
  f.action=`/classroom/student/${id}/delete`;
  document.body.appendChild(f);
  f.submit();
}

function closeStudentModal(){studentModal.classList.remove('show');}

// --- Import & Assign ---
const importModal=document.getElementById('importModal');function openImportModal(){importModal.classList.add('show');}function closeImportModal(){importModal.classList.remove('show');}
const assignModal=document.getElementById('assignModal');function openAssignModal(){assignModal.classList.add('show');}function closeAssignModal(){assignModal.classList.remove('show');}

// Close Events
[studentModal,importModal,assignModal].forEach(m=>m.addEventListener('click',e=>{if(e.target===m)m.classList.remove('show');}));
document.addEventListener('keydown',e=>{if(e.key==='Escape'){closeStudentModal();closeImportModal();closeAssignModal();}});
</script>
{% endblock %}
