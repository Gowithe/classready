{% extends "base.html" %}
{% block title %}My Classrooms{% endblock %}

{% block extra_css %}
<style>
  .wrap{max-width:1200px;margin:1.25rem auto;padding:0 1rem;}
  
  /* Header */
  .page-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    flex-wrap:wrap;
    gap:16px;
    margin-bottom:24px;
  }
  .page-title{
    font-size:1.5rem;
    font-weight:900;
    color:#1e293b;
    display:flex;
    align-items:center;
    gap:10px;
  }
  .page-subtitle{
    color:#64748b;
    font-size:.95rem;
    margin-top:4px;
  }
  
  /* Buttons */
  .btn{
    display:inline-flex;
    align-items:center;
    gap:.5rem;
    border:none;
    border-radius:12px;
    padding:.75rem 1.25rem;
    font-weight:700;
    text-decoration:none;
    cursor:pointer;
    transition:all .2s;
    font-size:.95rem;
  }
  .btn-primary{
    background:linear-gradient(135deg,#667eea,#764ba2);
    color:#fff;
    box-shadow:0 4px 14px rgba(102,126,234,.35);
  }
  .btn-primary:hover{
    transform:translateY(-2px);
    box-shadow:0 6px 20px rgba(102,126,234,.45);
  }
  .btn-secondary{
    background:#f1f5f9;
    color:#475569;
    border:1px solid #e2e8f0;
  }
  .btn-secondary:hover{
    background:#e2e8f0;
  }
  
  /* Stats */
  .stats-row{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));
    gap:16px;
    margin-bottom:24px;
  }
  .stat-card{
    background:#fff;
    border:1px solid rgba(0,0,0,.08);
    border-radius:16px;
    padding:20px;
    text-align:center;
    box-shadow:0 4px 12px rgba(0,0,0,.04);
  }
  .stat-icon{font-size:2rem;margin-bottom:8px;}
  .stat-value{font-size:2rem;font-weight:900;color:#667eea;}
  .stat-label{color:#64748b;font-size:.85rem;margin-top:4px;}
  
  /* Classroom Grid */
  .classroom-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(320px, 1fr));
    gap:20px;
  }
  
  .classroom-card{
    background:#fff;
    border:1px solid rgba(0,0,0,.08);
    border-radius:20px;
    overflow:hidden;
    box-shadow:0 4px 16px rgba(0,0,0,.06);
    transition:all .2s;
  }
  .classroom-card:hover{
    transform:translateY(-4px);
    box-shadow:0 12px 32px rgba(0,0,0,.1);
  }
  
  .classroom-header{
    background:linear-gradient(135deg,#667eea,#764ba2);
    color:#fff;
    padding:20px;
    position:relative;
  }
  .classroom-header .grade-badge{
    position:absolute;
    top:16px;
    right:16px;
    background:rgba(255,255,255,.2);
    padding:4px 12px;
    border-radius:20px;
    font-size:.8rem;
    font-weight:700;
  }
  .classroom-name{
    font-size:1.3rem;
    font-weight:900;
    margin-bottom:4px;
  }
  .classroom-year{
    opacity:.85;
    font-size:.9rem;
  }
  
  .classroom-body{
    padding:20px;
  }
  .classroom-stats{
    display:flex;
    gap:20px;
    margin-bottom:16px;
  }
  .classroom-stat{
    text-align:center;
    flex:1;
  }
  .classroom-stat .num{
    font-size:1.5rem;
    font-weight:900;
    color:#1e293b;
  }
  .classroom-stat .label{
    font-size:.75rem;
    color:#64748b;
    text-transform:uppercase;
  }
  
  .classroom-actions{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
  }
  .classroom-actions .btn{
    flex:1;
    justify-content:center;
    padding:.6rem .8rem;
    font-size:.85rem;
  }
  
  /* Empty State */
  .empty-state{
    text-align:center;
    padding:60px 20px;
    background:#fff;
    border:2px dashed #e2e8f0;
    border-radius:20px;
  }
  .empty-icon{font-size:4rem;margin-bottom:16px;}
  .empty-title{font-size:1.25rem;font-weight:800;color:#1e293b;margin-bottom:8px;}
  .empty-text{color:#64748b;margin-bottom:20px;}
  
  /* Modal */
  .modal-overlay{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(15,23,42,.6);
    z-index:1000;
    align-items:center;
    justify-content:center;
    padding:16px;
  }
  .modal-overlay.show{display:flex;}
  .modal-box{
    background:#fff;
    border-radius:20px;
    width:100%;
    max-width:500px;
    max-height:90vh;
    overflow:hidden;
    box-shadow:0 20px 60px rgba(0,0,0,.3);
  }
  .modal-header{
    background:linear-gradient(135deg,#667eea,#764ba2);
    color:#fff;
    padding:20px 24px;
    display:flex;
    justify-content:space-between;
    align-items:center;
  }
  .modal-header h3{margin:0;font-size:1.2rem;}
  .modal-close{
    background:rgba(255,255,255,.2);
    border:none;
    color:#fff;
    width:32px;
    height:32px;
    border-radius:8px;
    cursor:pointer;
    font-size:1.2rem;
  }
  .modal-body{padding:24px;max-height:calc(90vh - 140px);overflow-y:auto;}
  .modal-footer{
    padding:16px 24px;
    background:#f8fafc;
    border-top:1px solid #e2e8f0;
    display:flex;
    justify-content:flex-end;
    gap:10px;
  }
  
  .form-group{margin-bottom:16px;}
  .form-group label{
    display:block;
    font-weight:700;
    margin-bottom:6px;
    color:#334155;
  }
  .form-group input,
  .form-group select,
  .form-group textarea{
    width:100%;
    padding:.75rem 1rem;
    border:1px solid #e2e8f0;
    border-radius:10px;
    font-size:1rem;
    transition:border-color .2s;
  }
  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus{
    outline:none;
    border-color:#667eea;
  }
  .form-row{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:12px;
  }
</style>
{% endblock %}

{% block content %}
<div class="wrap">
  <!-- Header -->
  <div class="page-header">
    <div>
      <div class="page-title">üè´ My Classrooms</div>
      <div class="page-subtitle">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•</div>
    </div>
    <div style="display:flex;gap:10px;">
      <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">‚Üê Dashboard</a>
      <button class="btn btn-primary" onclick="openCreateModal()">‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
    </div>
  </div>

  <!-- Stats -->
  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-icon">üè´</div>
      <div class="stat-value">{{ classrooms|length }}</div>
      <div class="stat-label">‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üë®‚Äçüéì</div>
      <div class="stat-value">{{ total_students }}</div>
      <div class="stat-label">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üìã</div>
      <div class="stat-value">{{ total_assignments }}</div>
      <div class="stat-label">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢</div>
    </div>
  </div>

  <!-- Classroom Grid -->
  {% if classrooms %}
  <div class="classroom-grid">
    {% for cls in classrooms %}
    <div class="classroom-card">
      <div class="classroom-header">
        {% if cls.grade_level %}
        <span class="grade-badge">{{ cls.grade_level }}</span>
        {% endif %}
        <div class="classroom-name">{{ cls.name }}</div>
        <div class="classroom-year">{{ cls.academic_year or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤' }}</div>
      </div>
      <div class="classroom-body">
        <div class="classroom-stats">
          <div class="classroom-stat">
            <div class="num">{{ cls.student_count or 0 }}</div>
            <div class="label">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
          </div>
          <div class="classroom-stat">
            <div class="num">{{ cls.assignment_count or 0 }}</div>
            <div class="label">‡∏á‡∏≤‡∏ô</div>
          </div>
        </div>
        <div class="classroom-actions">
          <a href="{{ url_for('classroom_detail', classroom_id=cls.id) }}" class="btn btn-primary">üìÇ ‡πÄ‡∏õ‡∏¥‡∏î</a>
          <button class="btn btn-secondary" onclick="openEditModal({{ cls|tojson|e }})">‚úèÔ∏è</button>
          <button class="btn btn-secondary" onclick="deleteClassroom({{ cls.id }}, '{{ cls.name }}')" style="color:#ef4444;">üóëÔ∏è</button>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state">
    <div class="empty-icon">üè´</div>
    <div class="empty-title">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
    <div class="empty-text">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô</div>
    <button class="btn btn-primary" onclick="openCreateModal()">‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏£‡∏Å</button>
  </div>
  {% endif %}
</div>

<!-- Create/Edit Modal -->
<div class="modal-overlay" id="classroomModal">
  <div class="modal-box">
    <div class="modal-header">
      <h3 id="modalTitle">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    <form id="classroomForm" method="POST">
      <div class="modal-body">
        <input type="hidden" id="classroomId" name="classroom_id">
        
        <div class="form-group">
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á <span style="color:#ef4444">*</span></label>
          <input type="text" id="classroomName" name="name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°.1/1, ‡∏õ.6/2">
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label>
            <select id="gradeLevel" name="grade_level">
              <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
              <option value="‡∏õ.1">‡∏õ.1</option>
              <option value="‡∏õ.2">‡∏õ.2</option>
              <option value="‡∏õ.3">‡∏õ.3</option>
              <option value="‡∏õ.4">‡∏õ.4</option>
              <option value="‡∏õ.5">‡∏õ.5</option>
              <option value="‡∏õ.6">‡∏õ.6</option>
              <option value="‡∏°.1">‡∏°.1</option>
              <option value="‡∏°.2">‡∏°.2</option>
              <option value="‡∏°.3">‡∏°.3</option>
              <option value="‡∏°.4">‡∏°.4</option>
              <option value="‡∏°.5">‡∏°.5</option>
              <option value="‡∏°.6">‡∏°.6</option>
            </select>
          </div>
          <div class="form-group">
            <label>‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
            <input type="text" id="academicYear" name="academic_year" placeholder="‡πÄ‡∏ä‡πà‡∏ô 2567">
          </div>
        </div>
        
        <div class="form-group">
          <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
          <textarea id="classroomDesc" name="description" rows="3" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏¥‡∏ä‡∏≤‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button type="submit" class="btn btn-primary" id="submitBtn">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </form>
  </div>
</div>

<script>
const modal = document.getElementById('classroomModal');
const form = document.getElementById('classroomForm');
let isEdit = false;

function openCreateModal() {
  isEdit = false;
  document.getElementById('modalTitle').textContent = '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà';
  document.getElementById('submitBtn').textContent = '‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á';
  form.action = "{{ url_for('classroom_create') }}";
  form.reset();
  document.getElementById('classroomId').value = '';
  modal.classList.add('show');
}

function openEditModal(cls) {
  isEdit = true;
  document.getElementById('modalTitle').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô';
  document.getElementById('submitBtn').textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
  form.action = `/classroom/${cls.id}/edit`;
  
  document.getElementById('classroomId').value = cls.id;
  document.getElementById('classroomName').value = cls.name || '';
  document.getElementById('gradeLevel').value = cls.grade_level || '';
  document.getElementById('academicYear').value = cls.academic_year || '';
  document.getElementById('classroomDesc').value = cls.description || '';
  
  modal.classList.add('show');
}

function closeModal() {
  modal.classList.remove('show');
}

function deleteClassroom(id, name) {
  if (!confirm(`‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á "${name}"?\n\n‡∏à‡∏∞‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢!`)) return;
  
  const form = document.createElement('form');
  form.method = 'POST';
  form.action = `/classroom/${id}/delete`;
  document.body.appendChild(form);
  form.submit();
}

// Close on overlay click
modal.addEventListener('click', (e) => {
  if (e.target === modal) closeModal();
});

// Close on Escape
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') closeModal();
});
</script>
{% endblock %}
